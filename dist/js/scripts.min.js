/*!
 * =============================
 * =	Mike Pinto             =
 * =	mspkvp@github.com      =
 * =	Â©2017 tk7movespretty   =
 * ============================= */
!function(e){"use strict";function t(){if(void 0!==Cookies.get("tk7moves")){d3.select("#platf-select > option:nth-child("+(L+1)+")").attr("selected",!1),d3.select("#lang-select > option:nth-child("+(C+1)+")").attr("selected",!1);var e=JSON.parse(Cookies.get("tk7moves"));A=e.selected_char,w=e.lang,C=e.lang_index,_=e.jap,L=e.bl_choice,d3.select("#platf-select > option:nth-child("+(L+1)+")").attr("selected",!0),d3.select("#lang-select > option:nth-child("+(C+1)+")").attr("selected",!0)}else s()}function s(){Cookies.set("tk7moves",JSON.stringify({selected_char:A,lang:w,lang_index:C,jap:_,bl_choice:L}),{expires:30,path:""})}function l(e){return e.toLowerCase()!=e.toUpperCase()}function a(e){d3.select(".move-table").remove(),d3.select(".char-movelist .inner-table").html('<table class="move-table"></table>');var t=k[A].c.split(" ");d3.select("#"+t[0]).classed("selected",!1),t=k[A=e].c.split(" "),d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(k[A].n),s(),x&&N()}function i(e){g("./assets/data/movelists/MOVELIST_"+e+".json").then(function(t){a(e),c(e,t.moves)}).catch(function(e){console.log("Failed to find movelist",e)})}function c(e,t){let s=0;for(let l=0;l<t.length;l++){let a=t[l],i=!a.number>0,c=d3.select(".move-table").append("tr");i?c.html(n(a)):(s++,c.html(o(e,a)))}p(s),document.querySelector("#movelist_tab > table").firstElementChild.scrollIntoView(!0)}function n(e){return'<td class="move-card"><div class="move-info"><div class="move-number">&#9733;</div><div class="move-title"><div class="move-name" style="margin-bottom:5px;">'+e.name[_?0:1]+"</div></div></div></td>"}function o(e,t){let s='<td class="move-card">';return s+=r(e,t),s+=u(t),s+="</td>"}function r(e,t){let s='<div class="move-info">';return s+='<div class="move-number">'+t.number+'</div><div class="move-title"><div class="move-name">'+t.name[_?0:1]+'</div><div class="move-hitamount">'+t.ds.length+(t.ds.length>1?" Hits":" Hit")+"</div></div>",s+=d(t),s+=v(e,t),s+="</div>"}function d(e){let t='<div class="move-string">',s=e.command[w].split(" ");for(let e=0;e<s.length;e++){let a=s[e];if(/[a-z]/.test(a.toLowerCase()))t+='<p class="move-hint">'+a+"</p>";else for(let e=0;e<a.length;e++)try{l(b[a.charAt(e)])?b[a.charAt(e)]===b[a.charAt(e)].toLowerCase()||"N"===b[a.charAt(e)]?t+='<img class="move-arrow" src="./assets/arrow/'+b[a.charAt(e)].toLowerCase()+'.svg">':t+='<img class="move-arrow" src="./assets/arrow/'+b[a.charAt(e)].toLowerCase()+'p.svg">':isNaN(b[a.charAt(e)].charAt(0))?">"===b[a.charAt(e)]?t+='<p class="move-hint" style="color:#37ff05;font-size:20px;"><i class="fa fa-chevron-right" aria-hidden="true"></i></p>':(console.log("1. Not added: "+a.charAt(e)),console.log("2. Not added map: "+b[a.charAt(e)])):t+='<img class="move-button" src="./assets/button/'+j[L]+"/"+b[a.charAt(e)]+'.svg">'}catch(s){"("===a.charAt(e)||a.charAt(e),t+='<p class="move-hint">'+a.charAt(e)+"</p>"}}return t+="</div>"}function v(e,t){let s='<div class="move-hit-dmg"><div class="move-hitlvlstring">';for(let l=0;l<t.at.length;l++){try{s+='<p class="mv-hitlvl hit'+y[t.at[l].l].toLowerCase()+'">'+y[t.at[l].l]+(t.at[l].t>0?" Throw":"")+"</p>"}catch(s){throw console.log(t.at[l].l),console.log(y[t.at[l].l]),console.log("Fighter: "+e),console.log(t.number),s}l+1<t.at.length&&(s+='<i class="fa fa-chevron-right" aria-hidden="true"></i>')}return s+=h(t),s+="</div>",s+=m(t),s+="</div>"}function m(e){let t='<div class="move-dmg"><p class="mv-frames">'+e.d+'</p><p class="mv-id">Damage</p><div class="move-hitdmg-section"><i id="dmgmove'+e.number+'" class="fa fa-plus-square" aria-hidden="true"></i><div class="move-hitdmg">';for(let s=0;s<e.ds.length;s++)t+=e.ds[s].d,s+1<e.ds.length&&(t+="+");return t+="</div></div></div>"}function h(e){let t="";if(e.br.length>0){let s="";switch(e.br[0].b){case 1:s="1";break;case 2:s="2";break;case 3:s="1/2";break;case 4:s="1+2";break;default:s=""}t+='<i class="fa fa-caret-right" aria-hidden="true"></i>',t+='<p class="mv-hitlvl">'+e.br[0].f+"F BREAK "+s+"</p>"}return t}function f(e){let t='<table class="move-frames"><tr class="move-startf"><td class="mv-id">Start</td><td class="mv-frames">'+e.s+"F</td></tr>";if(e.s>0){t+='<tr class="move-startf-seg"><td>'+e.s+"F = ";for(var s=1;s<e.ss.length;s++)t+=e.ss[s].s,s+1<e.ss.length&&(t+="+");t+="</td></tr>"}return t+='<tr class="move-blockf"><td class="mv-id">Block</td><td class="mv-frames '+(e.blk>-1?'blkpositive">+':e.blk<-10?'blknegative">':'blkmild">')+e.blk+"</td></tr>",t+='<tr class="move-hitf"><td class="mv-id">Hit</td><td class="mv-frames">'+(e.adv>0?"+"+e.adv:e.adv)+"</td></tr></table>"}function u(e){let t='<div class="move-extra"><div class="mv-section"><div class="move-special">';return e.b9&&(t+='<p class="spin">SPIN</p>'),e.b8&&(t+='<p class="armor">ARMOR</p>'),e.bB&&(t+='<p class="track">TRACK</p>'),t+="</div>",t+=f(e),t+="</div>",t+="</div>"}function p(e){for(let t=1;t<=e;t++)d3.select("#dmgmove"+t).on("mouseenter",function(){d3.select("i#"+this.id+" + div.move-hitdmg").style("display","initial")}),d3.select("#dmgmove"+t).on("mouseleave",function(){setTimeout(()=>{d3.select("i#"+this.id+" + div.move-hitdmg").style("display","none")},3e3)})}function g(e){return new Promise(function(t,s){d3.json(e,function(e,l){e&&s(e),t(l)})})}var b,k=[],y=[],A="32",w=1,C=0,_=!1,S=!1,x=!1,j=["STEAM","PS4","XBOX"],L=2;String.prototype.hexEncode=function(){var e,t="";for(e=0;e<this.length;e++)t+=("000"+this.charCodeAt(e).toString(16)).slice(-4);return t},String.prototype.hexDecode=function(){var e,t=this.match(/.{1,4}/g)||[],s="";for(e=0;e<t.length;e++)s+=String.fromCharCode(parseInt(t[e],16));return s};var N=function(){x?d3.select("#charmenu").style("display","none"):d3.select("#charmenu").style("display","initial"),x=!x};e.importdata=function(){t(),g("./assets/data/map_hits.json").then(function(e){for(var t in e)y[e[t].i]=e[t].h;return g("./assets/data/map_ctrls.json")}).then(function(e){return b=e,g("./assets/data/map_chars.json")}).then(function(e){for(let t in e)k[e[t].i]={c:e[t].c,n:e[t].n};for(let t=0;t<e.length;t++){let s=e[t].c_index.split(" ");"11"==e[t].i&&(s=e[t].c.split("-")),d3.select(".char-menu > .inner-table > table").append("tr").html('<td class="char-card" id="'+e[t].c.split(" ")[0]+'"><img src="./assets/chars/'+s.join("").toLowerCase()+'_thumbnail.png"><p>'+e[t].c+"</p></td>"),d3.select("#"+e[t].c.split(" ")[0]).on("click",function(){i(e[t].i)})}let t=k[A].c.split(" ");d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(k[A].n),i(A)})},e.toggleCharMenu=N,e.togglePreferences=function(){S?d3.select("#preferences").style("visibility","hidden"):d3.select("#preferences").style("visibility","visible"),S=!S}}(window);