/*!
 * =============================
 * =	Mike Pinto             =
 * =	mspkvp@github.com      =
 * =	Â©2017 tk7movespretty   =
 * ============================= */
!function(e){"use strict";function t(){if(void 0!==Cookies.get("tk7moves")){d3.select("#platf-select > option:nth-child("+(F+1)+")").attr("selected",!1),d3.select("#lang-select > option:nth-child("+(L+1)+")").attr("selected",!1);var e=JSON.parse(Cookies.get("tk7moves"));C=e.selected_char,_=e.lang,L=e.lang_index,x=e.jap,F=e.bl_choice,d3.select("#platf-select > option:nth-child("+(F+1)+")").attr("selected",!0),d3.select("#lang-select > option:nth-child("+(L+1)+")").attr("selected",!0)}else s()}function s(){Cookies.set("tk7moves",JSON.stringify({selected_char:C,lang:_,lang_index:L,jap:x,bl_choice:F}),{expires:30,path:""})}function l(e){return e.toLowerCase()!=e.toUpperCase()}function i(e){d3.select(".move-table").remove(),d3.select(".char-movelist .inner-table").html('<table class="move-table"></table>');var t=k[C].c.split(" ");d3.select("#"+t[0]).classed("selected",!1),t=k[C=e].c.split(" "),d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(k[C].n),s(),P&&B()}function a(e){y("./assets/data/movelists/MOVELIST_"+e+".json").then(function(t){i(e),S=t.moves,o(e,S)}).catch(function(e){console.log("Failed to find movelist",e)})}function c(e){let t="",s=e.command[_].split(" ");for(let e=0;e<s.length;e++){let i=s[e];if(/[a-z]/.test(i.toLowerCase()));else for(let e=0;e<i.length;e++){let s="";try{l(A[i.charAt(e)])?s=(A[i.charAt(e)]===A[i.charAt(e)].toLowerCase()||A[i.charAt(e)],A[i.charAt(e)].toLowerCase()):isNaN(A[i.charAt(e)].charAt(0))||(s=A[i.charAt(e)])}catch(e){}t+=s}}return t}function r(){return{moveString:document.querySelector("#move-string-filter").value,specialProperties:{spin:document.querySelector("#move-property-spin-filter").checked,track:document.querySelector("#move-property-track-filter").checked,armor:document.querySelector("#move-property-armor-filter").checked}}}function o(e,t){let s=0;for(let l=0;l<t.length;l++){let i=t[l],a=!i.number>0,c=d3.select(".move-table").append("tr");a?c.html(n(i)):(s++,c.html(d(e,i)))}b(s),document.querySelector("#movelist_tab > table").firstElementChild.scrollIntoView(!0)}function n(e){return'<td class="move-card"><div class="move-info"><div class="move-number">&#9733;</div><div class="move-title"><div class="move-name" style="margin-bottom:5px;">'+e.name[x?0:1]+"</div></div></div></td>"}function d(e,t){let s='<td class="move-card">';return s+=v(e,t),s+=g(t),s+="</td>"}function v(e,t){let s='<div class="move-info">';return s+='<div class="move-number">'+t.number+'</div><div class="move-title"><div class="move-name">'+t.name[x?0:1]+'</div><div class="move-hitamount">'+t.ds.length+(t.ds.length>1?" Hits":" Hit")+"</div></div>",s+=m(t),s+=h(e,t),s+="</div>"}function m(e){let t='<div class="move-string">',s=e.command[_].split(" ");for(let e=0;e<s.length;e++){let i=s[e];if(/[a-z]/.test(i.toLowerCase()))t+='<p class="move-hint">'+i+"</p>";else for(let e=0;e<i.length;e++)try{l(A[i.charAt(e)])?A[i.charAt(e)]===A[i.charAt(e)].toLowerCase()||"N"===A[i.charAt(e)]?t+='<img class="move-arrow" src="./assets/arrow/'+A[i.charAt(e)].toLowerCase()+'.svg">':t+='<img class="move-arrow" src="./assets/arrow/'+A[i.charAt(e)].toLowerCase()+'p.svg">':isNaN(A[i.charAt(e)].charAt(0))?">"===A[i.charAt(e)]?t+='<p class="move-hint" style="color:#37ff05;font-size:20px;"><i class="fa fa-chevron-right" aria-hidden="true"></i></p>':(console.log("1. Not added: "+i.charAt(e)),console.log("2. Not added map: "+A[i.charAt(e)])):t+='<img class="move-button" src="./assets/button/'+q[F]+"/"+A[i.charAt(e)]+'.svg">'}catch(s){"("===i.charAt(e)||i.charAt(e),t+='<p class="move-hint">'+i.charAt(e)+"</p>"}}return t+="</div>"}function h(e,t){let s='<div class="move-hit-dmg"><div class="move-hitlvlstring">';for(let l=0;l<t.at.length;l++){try{s+='<p class="mv-hitlvl hit'+w[t.at[l].l].toLowerCase()+'">'+w[t.at[l].l]+(t.at[l].t>0?" Throw":"")+"</p>"}catch(s){throw console.log(t.at[l].l),console.log(w[t.at[l].l]),console.log("Fighter: "+e),console.log(t.number),s}l+1<t.at.length&&(s+='<i class="fa fa-chevron-right" aria-hidden="true"></i>')}return s+=u(t),s+="</div>",s+=f(t),s+="</div>"}function f(e){let t='<div class="move-dmg"><p class="mv-frames">'+e.d+'</p><p class="mv-id">Damage</p><div class="move-hitdmg-section"><i id="dmgmove'+e.number+'" class="fa fa-plus-square" aria-hidden="true"></i><div class="move-hitdmg">';for(let s=0;s<e.ds.length;s++)t+=e.ds[s].d,s+1<e.ds.length&&(t+="+");return t+="</div></div></div>"}function u(e){let t="";if(e.br.length>0){let s="";switch(e.br[0].b){case 1:s="1";break;case 2:s="2";break;case 3:s="1/2";break;case 4:s="1+2";break;default:s=""}t+='<i class="fa fa-caret-right" aria-hidden="true"></i>',t+='<p class="mv-hitlvl">'+e.br[0].f+"F BREAK "+s+"</p>"}return t}function p(e){let t='<table class="move-frames"><tr class="move-startf"><td class="mv-id">Start</td><td class="mv-frames">'+e.s+"F</td></tr>";if(e.s>0){t+='<tr class="move-startf-seg"><td>'+e.s+"F = ";for(var s=1;s<e.ss.length;s++)t+=e.ss[s].s,s+1<e.ss.length&&(t+="+");t+="</td></tr>"}return t+='<tr class="move-blockf"><td class="mv-id">Block</td><td class="mv-frames '+(e.blk>-1?'blkpositive">+':e.blk<-10?'blknegative">':'blkmild">')+e.blk+"</td></tr>",t+='<tr class="move-hitf"><td class="mv-id">Hit</td><td class="mv-frames">'+(e.adv>0?"+"+e.adv:e.adv)+"</td></tr></table>"}function g(e){let t='<div class="move-extra"><div class="mv-section"><div class="move-special">';return e.b9&&(t+='<p class="spin">SPIN</p>'),e.b8&&(t+='<p class="armor">ARMOR</p>'),e.bB&&(t+='<p class="track">TRACK</p>'),t+="</div>",t+=p(e),t+="</div>",t+="</div>"}function b(e){for(let t=1;t<=e;t++)d3.select("#dmgmove"+t).on("mouseenter",function(){d3.select("i#"+this.id+" + div.move-hitdmg").style("display","initial")}),d3.select("#dmgmove"+t).on("mouseleave",function(){setTimeout(()=>{d3.select("i#"+this.id+" + div.move-hitdmg").style("display","none")},3e3)})}function y(e){return new Promise(function(t,s){d3.json(e,function(e,l){e&&s(e),t(l)})})}var A,k=[],w=[],C="32",S=null,_=1,L=0,x=!1,N=!1,j=!1,P=!1,q=["STEAM","PS4","XBOX"],F=2;String.prototype.hexEncode=function(){var e,t="";for(e=0;e<this.length;e++)t+=("000"+this.charCodeAt(e).toString(16)).slice(-4);return t},String.prototype.hexDecode=function(){var e,t=this.match(/.{1,4}/g)||[],s="";for(e=0;e<t.length;e++)s+=String.fromCharCode(parseInt(t[e],16));return s};var B=function(){P?d3.select("#charmenu").style("display","none"):d3.select("#charmenu").style("display","initial"),P=!P};e.importdata=function(){t(),y("./assets/data/map_hits.json").then(function(e){for(var t in e)w[e[t].i]=e[t].h;return y("./assets/data/map_ctrls.json")}).then(function(e){return A=e,y("./assets/data/map_chars.json")}).then(function(e){for(let t in e)k[e[t].i]={c:e[t].c,n:e[t].n};for(let t=0;t<e.length;t++){let s=e[t].c_index.split(" ");"11"==e[t].i&&(s=e[t].c.split("-")),d3.select(".char-menu > .inner-table > table").append("tr").html('<td class="char-card" id="'+e[t].c.split(" ")[0]+'"><img src="./assets/chars/'+s.join("").toLowerCase()+'_thumbnail.png"><p>'+e[t].c+"</p></td>"),d3.select("#"+e[t].c.split(" ")[0]).on("click",function(){a(e[t].i)})}let t=k[C].c.split(" ");d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(k[C].n),a(C)})},e.toggleCharMenu=B,e.togglePreferences=function(){N?d3.select("#preferences").style("visibility","hidden"):d3.select("#preferences").style("visibility","visible"),N=!N},e.toggleFilter=function(){j?d3.select("#filter").style("visibility","hidden"):d3.select("#filter").style("visibility","visible"),j=!j},e.filterMoveList=function(){let e=r(),t=S.filter(function(t){let s=c(t),l=!0;return e.moveString&&(l=l&&s.match(e.moveString)),console.log(e),e.specialProperties.spin&&(l=l&&t.b9),e.specialProperties.armor&&(l=l&&t.b8),e.specialProperties.track&&(l=l&&t.bB),l});i(C),o(C,t)}}(window);