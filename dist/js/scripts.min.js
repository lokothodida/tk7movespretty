/*!
 * =============================
 * =	Mike Pinto             =
 * =	mspkvp@github.com      =
 * =	Â©2017 tk7movespretty   =
 * ============================= */
!function(e){"use strict";function t(){if(void 0!==Cookies.get("tk7moves")){d3.select("#platf-select > option:nth-child("+(F+1)+")").attr("selected",!1),d3.select("#lang-select > option:nth-child("+(L+1)+")").attr("selected",!1);var e=JSON.parse(Cookies.get("tk7moves"));C=e.selected_char,P=e.lang,L=e.lang_index,q=e.jap,F=e.bl_choice,d3.select("#platf-select > option:nth-child("+(F+1)+")").attr("selected",!0),d3.select("#lang-select > option:nth-child("+(L+1)+")").attr("selected",!0)}else s()}function s(){Cookies.set("tk7moves",JSON.stringify({selected_char:C,lang:P,lang_index:L,jap:q,bl_choice:F}),{expires:30,path:""})}function r(e){return e.toLowerCase()!=e.toUpperCase()}function a(e){d3.select(".move-table").remove(),d3.select(".char-movelist .inner-table").html('<table class="move-table"></table>');var t=S[C].c.split(" ");d3.select("#"+t[0]).classed("selected",!1),t=S[C=e].c.split(" "),d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(S[C].n),s(),j&&B()}function l(e){k("./assets/data/movelists/MOVELIST_"+e+".json").then(function(t){a(e),N=t.moves,n(e,N)}).catch(function(e){console.log("Failed to find movelist",e)})}function i(e,t,s){switch(s){case"<=":return e<=t;case"<":return e<t;case">=":return e>=t;case">":return e>t;default:return e==t}}function o(e){let t="",s=e.command[P].split(" ");for(let e=0;e<s.length;e++){let a=s[e];if(/[a-z]/.test(a.toLowerCase()));else for(let e=0;e<a.length;e++){let s="";try{r(A[a.charAt(e)])?s=(A[a.charAt(e)]===A[a.charAt(e)].toLowerCase()||A[a.charAt(e)],A[a.charAt(e)].toLowerCase()):isNaN(A[a.charAt(e)].charAt(0))||(s=A[a.charAt(e)])}catch(e){}t+=s}}return t}function c(){let e=document.querySelector("#move-name-filter").value,t=document.querySelector("#move-string-filter").value,s={spin:document.querySelector("#move-property-spin-filter").checked,track:document.querySelector("#move-property-track-filter").checked,armor:document.querySelector("#move-property-armor-filter").checked},r={start:{value:document.querySelector("#frame-property-start-filter").value,comparison:document.querySelector("#frame-property-start-comparison-filter").value},block:{value:document.querySelector("#frame-property-block-filter").value,comparison:document.querySelector("#frame-property-block-comparison-filter").value},hit:{value:document.querySelector("#frame-property-hit-filter").value,comparison:document.querySelector("#frame-property-hit-comparison-filter").value}};return r.start.value=parseInt(r.start.value),r.block.value=parseInt(r.block.value),r.hit.value=parseInt(r.hit.value),{moveName:e,moveString:t,specialProperties:s,frameProperties:r}}function n(e,t){let s=0;for(let r=0;r<t.length;r++){let a=t[r],l=!a.number>0,i=d3.select(".move-table").append("tr");l?i.html(d(a)):(s++,i.html(m(e,a)))}y(s);let r=document.querySelector("#movelist_tab > table").firstElementChild;r&&r.scrollIntoView(!0)}function d(e){return'<td class="move-card"><div class="move-info"><div class="move-number">&#9733;</div><div class="move-title"><div class="move-name" style="margin-bottom:5px;">'+e.name[q?0:1]+"</div></div></div></td>"}function m(e,t){let s='<td class="move-card">';return s+=v(e,t),s+=b(t),s+="</td>"}function v(e,t){let s='<div class="move-info">';return s+='<div class="move-number">'+t.number+'</div><div class="move-title"><div class="move-name">'+t.name[q?0:1]+'</div><div class="move-hitamount">'+t.ds.length+(t.ds.length>1?" Hits":" Hit")+"</div></div>",s+=u(t),s+=h(e,t),s+="</div>"}function u(e){let t='<div class="move-string">',s=e.command[P].split(" ");for(let e=0;e<s.length;e++){let a=s[e];if(/[a-z]/.test(a.toLowerCase()))t+='<p class="move-hint">'+a+"</p>";else for(let e=0;e<a.length;e++)try{r(A[a.charAt(e)])?A[a.charAt(e)]===A[a.charAt(e)].toLowerCase()||"N"===A[a.charAt(e)]?t+='<img class="move-arrow" src="./assets/arrow/'+A[a.charAt(e)].toLowerCase()+'.svg">':t+='<img class="move-arrow" src="./assets/arrow/'+A[a.charAt(e)].toLowerCase()+'p.svg">':isNaN(A[a.charAt(e)].charAt(0))?">"===A[a.charAt(e)]?t+='<p class="move-hint" style="color:#37ff05;font-size:20px;"><i class="fa fa-chevron-right" aria-hidden="true"></i></p>':(console.log("1. Not added: "+a.charAt(e)),console.log("2. Not added map: "+A[a.charAt(e)])):t+='<img class="move-button" src="./assets/button/'+I[F]+"/"+A[a.charAt(e)]+'.svg">'}catch(s){"("===a.charAt(e)||a.charAt(e),t+='<p class="move-hint">'+a.charAt(e)+"</p>"}}return t+="</div>"}function h(e,t){let s='<div class="move-hit-dmg"><div class="move-hitlvlstring">';for(let r=0;r<t.at.length;r++){try{s+='<p class="mv-hitlvl hit'+w[t.at[r].l].toLowerCase()+'">'+w[t.at[r].l]+(t.at[r].t>0?" Throw":"")+"</p>"}catch(s){throw console.log(t.at[r].l),console.log(w[t.at[r].l]),console.log("Fighter: "+e),console.log(t.number),s}r+1<t.at.length&&(s+='<i class="fa fa-chevron-right" aria-hidden="true"></i>')}return s+=p(t),s+="</div>",s+=f(t),s+="</div>"}function f(e){let t='<div class="move-dmg"><p class="mv-frames">'+e.d+'</p><p class="mv-id">Damage</p><div class="move-hitdmg-section"><i id="dmgmove'+e.number+'" class="fa fa-plus-square" aria-hidden="true"></i><div class="move-hitdmg">';for(let s=0;s<e.ds.length;s++)t+=e.ds[s].d,s+1<e.ds.length&&(t+="+");return t+="</div></div></div>"}function p(e){let t="";if(e.br.length>0){let s="";switch(e.br[0].b){case 1:s="1";break;case 2:s="2";break;case 3:s="1/2";break;case 4:s="1+2";break;default:s=""}t+='<i class="fa fa-caret-right" aria-hidden="true"></i>',t+='<p class="mv-hitlvl">'+e.br[0].f+"F BREAK "+s+"</p>"}return t}function g(e){let t='<table class="move-frames"><tr class="move-startf"><td class="mv-id">Start</td><td class="mv-frames">'+e.s+"F</td></tr>";if(e.s>0){t+='<tr class="move-startf-seg"><td>'+e.s+"F = ";for(var s=1;s<e.ss.length;s++)t+=e.ss[s].s,s+1<e.ss.length&&(t+="+");t+="</td></tr>"}return t+='<tr class="move-blockf"><td class="mv-id">Block</td><td class="mv-frames '+(e.blk>-1?'blkpositive">+':e.blk<-10?'blknegative">':'blkmild">')+e.blk+"</td></tr>",t+='<tr class="move-hitf"><td class="mv-id">Hit</td><td class="mv-frames">'+(e.adv>0?"+"+e.adv:e.adv)+"</td></tr></table>"}function b(e){let t='<div class="move-extra"><div class="mv-section"><div class="move-special">';return e.b9&&(t+='<p class="spin">SPIN</p>'),e.b8&&(t+='<p class="armor">ARMOR</p>'),e.bB&&(t+='<p class="track">TRACK</p>'),t+="</div>",t+=g(e),t+="</div>",t+="</div>"}function y(e){for(let t=1;t<=e;t++)d3.select("#dmgmove"+t).on("mouseenter",function(){d3.select("i#"+this.id+" + div.move-hitdmg").style("display","initial")}),d3.select("#dmgmove"+t).on("mouseleave",function(){setTimeout(()=>{d3.select("i#"+this.id+" + div.move-hitdmg").style("display","none")},3e3)})}function k(e){return new Promise(function(t,s){d3.json(e,function(e,r){e&&s(e),t(r)})})}var A,S=[],w=[],C="32",N=null,P=1,L=0,q=!1,_=!1,x=!1,j=!1,I=["STEAM","PS4","XBOX"],F=2;String.prototype.hexEncode=function(){var e,t="";for(e=0;e<this.length;e++)t+=("000"+this.charCodeAt(e).toString(16)).slice(-4);return t},String.prototype.hexDecode=function(){var e,t=this.match(/.{1,4}/g)||[],s="";for(e=0;e<t.length;e++)s+=String.fromCharCode(parseInt(t[e],16));return s};var B=function(){j?d3.select("#charmenu").style("display","none"):d3.select("#charmenu").style("display","initial"),j=!j};e.importdata=function(){t(),k("./assets/data/map_hits.json").then(function(e){for(var t in e)w[e[t].i]=e[t].h;return k("./assets/data/map_ctrls.json")}).then(function(e){return A=e,k("./assets/data/map_chars.json")}).then(function(e){for(let t in e)S[e[t].i]={c:e[t].c,n:e[t].n};for(let t=0;t<e.length;t++){let s=e[t].c_index.split(" ");"11"==e[t].i&&(s=e[t].c.split("-")),d3.select(".char-menu > .inner-table > table").append("tr").html('<td class="char-card" id="'+e[t].c.split(" ")[0]+'"><img src="./assets/chars/'+s.join("").toLowerCase()+'_thumbnail.png"><p>'+e[t].c+"</p></td>"),d3.select("#"+e[t].c.split(" ")[0]).on("click",function(){l(e[t].i)})}let t=S[C].c.split(" ");d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(S[C].n),l(C)})},e.toggleCharMenu=B,e.togglePreferences=function(){_?d3.select("#preferences").style("visibility","hidden"):d3.select("#preferences").style("visibility","visible"),_=!_},e.toggleFilter=function(){x?d3.select("#filter").style("visibility","hidden"):d3.select("#filter").style("visibility","visible"),x=!x},e.filterMoveList=function(){let e=c(),t=N.filter(function(t){let s=o(t),r=!0;return e.moveName&&(r=r&&t.name[q?0:1].toLowerCase().match(e.moveName.toLowerCase())),e.moveString&&(r=r&&s.match(e.moveString)),e.specialProperties.spin&&(r=r&&t.b9),e.specialProperties.armor&&(r=r&&t.b8),e.specialProperties.track&&(r=r&&t.bB),isNaN(e.frameProperties.start.value)||(r=r&&i(t.s,e.frameProperties.start.value,e.frameProperties.start.comparison)),isNaN(e.frameProperties.block.value)||(r=r&&i(t.blk,e.frameProperties.block.value,e.frameProperties.block.comparison)),isNaN(e.frameProperties.hit.value)||(r=r&&i(t.adv,e.frameProperties.hit.value,e.frameProperties.hit.comparison)),r});a(C),n(C,t)}}(window);