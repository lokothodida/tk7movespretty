/*!
 * =============================
 * =	Mike Pinto             =
 * =	mspkvp@github.com      =
 * =	Â©2017 tk7movespretty   =
 * ============================= */
!function(e){"use strict";function t(){if(void 0!==Cookies.get("tk7moves")){d3.select("#platf-select > option:nth-child("+(x+1)+")").attr("selected",!1),d3.select("#lang-select > option:nth-child("+(A+1)+")").attr("selected",!1);var e=JSON.parse(Cookies.get("tk7moves"));k=e.selected_char,y=e.lang,A=e.lang_index,w=e.jap,x=e.bl_choice,d3.select("#platf-select > option:nth-child("+(x+1)+")").attr("selected",!0),d3.select("#lang-select > option:nth-child("+(A+1)+")").attr("selected",!0)}else s()}function s(){Cookies.set("tk7moves",JSON.stringify({selected_char:k,lang:y,lang_index:A,jap:w,bl_choice:x}),{expires:30,path:""})}function l(e){return e.toLowerCase()!=e.toUpperCase()}function a(e){d3.select(".move-table").remove(),d3.select(".char-movelist .inner-table").html('<table class="move-table"></table>');var t=g[k].c.split(" ");d3.select("#"+t[0]).classed("selected",!1),t=g[k=e].c.split(" "),d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(g[k].n),s(),_&&j()}function i(e){return'<td class="move-card"><div class="move-info"><div class="move-number">&#9733;</div><div class="move-title"><div class="move-name" style="margin-bottom:5px;">'+e.name[w?0:1]+"</div></div></div></td>"}function c(e,t){let s='<td class="move-card">';return s+=n(e,t),s+=h(t),s+="</td>"}function n(e,t){let s='<div class="move-info">';return s+='<div class="move-number">'+t.number+'</div><div class="move-title"><div class="move-name">'+t.name[w?0:1]+'</div><div class="move-hitamount">'+t.ds.length+(t.ds.length>1?" Hits":" Hit")+"</div></div>",s+=o(t),s+=r(e,t),s+="</div>"}function o(e){let t='<div class="move-string">',s=e.command[y].split(" ");for(let e=0;e<s.length;e++){let a=s[e];if(/[a-z]/.test(a.toLowerCase()))t+='<p class="move-hint">'+a+"</p>";else for(let e=0;e<a.length;e++)try{l(p[a.charAt(e)])?p[a.charAt(e)]===p[a.charAt(e)].toLowerCase()||"N"===p[a.charAt(e)]?t+='<img class="move-arrow" src="./assets/arrow/'+p[a.charAt(e)].toLowerCase()+'.svg">':t+='<img class="move-arrow" src="./assets/arrow/'+p[a.charAt(e)].toLowerCase()+'p.svg">':isNaN(p[a.charAt(e)].charAt(0))?">"===p[a.charAt(e)]?t+='<p class="move-hint" style="color:#37ff05;font-size:20px;"><i class="fa fa-chevron-right" aria-hidden="true"></i></p>':(console.log("1. Not added: "+a.charAt(e)),console.log("2. Not added map: "+p[a.charAt(e)])):t+='<img class="move-button" src="./assets/button/'+S[x]+"/"+p[a.charAt(e)]+'.svg">'}catch(s){"("===a.charAt(e)||a.charAt(e),t+='<p class="move-hint">'+a.charAt(e)+"</p>"}}return t+="</div>"}function r(e,t){let s='<div class="move-hit-dmg"><div class="move-hitlvlstring">';for(let l=0;l<t.at.length;l++){try{s+='<p class="mv-hitlvl hit'+b[t.at[l].l].toLowerCase()+'">'+b[t.at[l].l]+(t.at[l].t>0?" Throw":"")+"</p>"}catch(s){throw console.log(t.at[l].l),console.log(b[t.at[l].l]),console.log("Fighter: "+e),console.log(t.number),s}l+1<t.at.length&&(s+='<i class="fa fa-chevron-right" aria-hidden="true"></i>')}return s+=v(t),s+="</div>",s+=d(t),s+="</div>"}function d(e){let t='<div class="move-dmg"><p class="mv-frames">'+e.d+'</p><p class="mv-id">Damage</p><div class="move-hitdmg-section"><i id="dmgmove'+e.number+'" class="fa fa-plus-square" aria-hidden="true"></i><div class="move-hitdmg">';for(let s=0;s<e.ds.length;s++)t+=e.ds[s].d,s+1<e.ds.length&&(t+="+");return t+="</div></div></div>"}function v(e){let t="";if(e.br.length>0){let s="";switch(e.br[0].b){case 1:s="1";break;case 2:s="2";break;case 3:s="1/2";break;case 4:s="1+2";break;default:s=""}t+='<i class="fa fa-caret-right" aria-hidden="true"></i>',t+='<p class="mv-hitlvl">'+e.br[0].f+"F BREAK "+s+"</p>"}return t}function m(e){let t='<table class="move-frames"><tr class="move-startf"><td class="mv-id">Start</td><td class="mv-frames">'+e.s+"F</td></tr>";if(e.s>0){t+='<tr class="move-startf-seg"><td>'+e.s+"F = ";for(var s=1;s<e.ss.length;s++)t+=e.ss[s].s,s+1<e.ss.length&&(t+="+");t+="</td></tr>"}return t+='<tr class="move-blockf"><td class="mv-id">Block</td><td class="mv-frames '+(e.blk>-1?'blkpositive">+':e.blk<-10?'blknegative">':'blkmild">')+e.blk+"</td></tr>",t+='<tr class="move-hitf"><td class="mv-id">Hit</td><td class="mv-frames">'+(e.adv>0?"+"+e.adv:e.adv)+"</td></tr></table>"}function h(e){let t='<div class="move-extra"><div class="mv-section"><div class="move-special">';return e.b9&&(t+='<p class="spin">SPIN</p>'),e.b8&&(t+='<p class="armor">ARMOR</p>'),e.bB&&(t+='<p class="track">TRACK</p>'),t+="</div>",t+=m(e),t+="</div>",t+="</div>"}function f(e){for(let t=1;t<=e;t++)d3.select("#dmgmove"+t).on("mouseenter",function(){d3.select("i#"+this.id+" + div.move-hitdmg").style("display","initial")}),d3.select("#dmgmove"+t).on("mouseleave",function(){setTimeout(()=>{d3.select("i#"+this.id+" + div.move-hitdmg").style("display","none")},3e3)})}function u(e){return new Promise(function(t,s){d3.json(e,function(e,l){e&&s(e),t(l)})})}var p,g=[],b=[],k="32",y=1,A=0,w=!1,C=!1,_=!1,S=["STEAM","PS4","XBOX"],x=2;String.prototype.hexEncode=function(){var e,t="";for(e=0;e<this.length;e++)t+=("000"+this.charCodeAt(e).toString(16)).slice(-4);return t},String.prototype.hexDecode=function(){var e,t=this.match(/.{1,4}/g)||[],s="";for(e=0;e<t.length;e++)s+=String.fromCharCode(parseInt(t[e],16));return s};var j=function(){_?d3.select("#charmenu").style("display","none"):d3.select("#charmenu").style("display","initial"),_=!_},L=function(e){u("./assets/data/movelists/MOVELIST_"+e+".json").then(function(t){a(e);let s=0;for(let l=0;l<t.moves.length;l++){let a=t.moves[l],n=!a.number>0,o=d3.select(".move-table").append("tr");n?o.html(i(a)):(s++,o.html(c(e,a)))}f(s),document.querySelector("#movelist_tab > table ").firstElementChild.scrollIntoView(!0)}).catch(function(e){console.log("Failed to find movelist",e)})};e.importdata=function(){t(),u("./assets/data/map_hits.json").then(function(e){for(var t in e)b[e[t].i]=e[t].h;return u("./assets/data/map_ctrls.json")}).then(function(e){return p=e,u("./assets/data/map_chars.json")}).then(function(e){for(let t in e)g[e[t].i]={c:e[t].c,n:e[t].n};for(let t=0;t<e.length;t++){let s=e[t].c_index.split(" ");"11"==e[t].i&&(s=e[t].c.split("-")),d3.select(".char-menu > .inner-table > table").append("tr").html('<td class="char-card" id="'+e[t].c.split(" ")[0]+'"><img src="./assets/chars/'+s.join("").toLowerCase()+'_thumbnail.png"><p>'+e[t].c+"</p></td>"),d3.select("#"+e[t].c.split(" ")[0]).on("click",function(){L(e[t].i)})}let t=g[k].c.split(" ");d3.select("#"+t[0]).classed("selected",!0),d3.select("#selected-title").text(g[k].n),L(k)})},e.toggleCharMenu=j,e.togglePreferences=function(){C?d3.select("#preferences").style("visibility","hidden"):d3.select("#preferences").style("visibility","visible"),C=!C}}(window);