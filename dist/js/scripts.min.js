/*!
 * =============================
 * =	Mike Pinto             =
 * =	mspkvp@github.com      =
 * =	Â©2017 tk7movespretty   =
 * ============================= */
!function(e){"use strict";function s(){if(void 0!==Cookies.get("tk7moves")){d3.select("#platf-select > option:nth-child("+(f+1)+")").attr("selected",!1),d3.select("#lang-select > option:nth-child("+(v+1)+")").attr("selected",!1);var e=JSON.parse(Cookies.get("tk7moves"));r=e.selected_char,d=e.lang,v=e.lang_index,n=e.jap,f=e.bl_choice,d3.select("#platf-select > option:nth-child("+(f+1)+")").attr("selected",!0),d3.select("#lang-select > option:nth-child("+(v+1)+")").attr("selected",!0)}else t()}function t(){Cookies.set("tk7moves",JSON.stringify({selected_char:r,lang:d,lang_index:v,jap:n,bl_choice:f}),{expires:30,path:""})}function a(e){return e.toLowerCase()!=e.toUpperCase()}function o(e){d3.select(".move-table").remove(),d3.select(".char-movelist .inner-table").html('<table class="move-table"></table>');var s=i[r].c.split(" ");d3.select("#"+s[0]).classed("selected",!1),s=i[r=e].c.split(" "),d3.select("#"+s[0]).classed("selected",!0),d3.select("#selected-title").text(i[r].n),t(),h&&g()}var l,i=[],c=[],r="32",d=1,v=0,n=!1,m=!1,h=!1,p=["STEAM","PS4","XBOX"],f=2;String.prototype.hexEncode=function(){var e,s="";for(e=0;e<this.length;e++)s+=("000"+this.charCodeAt(e).toString(16)).slice(-4);return s},String.prototype.hexDecode=function(){var e,s=this.match(/.{1,4}/g)||[],t="";for(e=0;e<s.length;e++)t+=String.fromCharCode(parseInt(s[e],16));return t};var g=function(){h?d3.select("#charmenu").style("display","none"):d3.select("#charmenu").style("display","initial"),h=!h},u=function(e){d3.json("./assets/data/movelists/MOVELIST_"+e+".json",function(s,t){o(e);var i=0;for(let s=0;s<t.moves.length;s++){if(!t.moves[s].number>0){let e='<td class="move-card"><div class="move-info"><div class="move-number">&#9733;</div><div class="move-title"><div class="move-name" style="margin-bottom:5px;">'+t.moves[s].name[n?0:1]+"</div></div></div></td>";d3.select(".move-table").append("tr").html(e);continue}i++;var r='<td class="move-card"><div class="move-info"><div class="move-number">'+t.moves[s].number+'</div><div class="move-title"><div class="move-name">'+t.moves[s].name[n?0:1]+'</div><div class="move-hitamount">'+t.moves[s].ds.length+(t.moves[s].ds.length>1?" Hits":" Hit")+"</div></div>";r+='<div class="move-string">';let o=t.moves[s].command[d].split(" ");for(let e=0;e<o.length;e++)if(/[a-z]/.test(o[e].toLowerCase()))r+='<p class="move-hint">'+o[e]+"</p>";else for(let s=0;s<o[e].length;s++)try{a(l[o[e].charAt(s)])?l[o[e].charAt(s)]===l[o[e].charAt(s)].toLowerCase()||"N"===l[o[e].charAt(s)]?r+='<img class="move-arrow" src="./assets/arrow/'+l[o[e].charAt(s)].toLowerCase()+'.svg">':r+='<img class="move-arrow" src="./assets/arrow/'+l[o[e].charAt(s)].toLowerCase()+'p.svg">':isNaN(l[o[e].charAt(s)].charAt(0))?">"===l[o[e].charAt(s)]?r+='<p class="move-hint" style="color:#37ff05;font-size:20px;"><i class="fa fa-chevron-right" aria-hidden="true"></i></p>':(console.log("1. Not added: "+o[e].charAt(s)),console.log("2. Not added map: "+l[o[e].charAt(s)])):r+='<img class="move-button" src="./assets/button/'+p[f]+"/"+l[o[e].charAt(s)]+'.svg">'}catch(t){"("===o[e].charAt(s)||o[e].charAt(s),r+='<p class="move-hint">'+o[e].charAt(s)+"</p>"}r+='</div><div class="move-hit-dmg"><div class="move-hitlvlstring">';for(let a=0;a<t.moves[s].at.length;a++){try{r+='<p class="mv-hitlvl hit'+c[t.moves[s].at[a].l].toLowerCase()+'">'+c[t.moves[s].at[a].l]+(t.moves[s].at[a].t>0?" Throw":"")+"</p>"}catch(o){throw console.log(t.moves[s].at[a].l),console.log(c[t.moves[s].at[a].l]),console.log("Fighter: "+e),console.log(t.moves[s].number),o}a+1<t.moves[s].at.length&&(r+='<i class="fa fa-chevron-right" aria-hidden="true"></i>')}if(t.moves[s].br.length>0){let e="";switch(t.moves[s].br[0].b){case 1:e="1";break;case 2:e="2";break;case 3:e="1/2";break;case 4:e="1+2";break;default:e=""}r+='<i class="fa fa-caret-right" aria-hidden="true"></i>',r+='<p class="mv-hitlvl">'+t.moves[s].br[0].f+"F BREAK "+e+"</p>"}r+="</div>",r+='<div class="move-dmg"><p class="mv-frames">'+t.moves[s].d+'</p><p class="mv-id">Damage</p><div class="move-hitdmg-section"><i id="dmgmove'+t.moves[s].number+'" class="fa fa-plus-square" aria-hidden="true"></i><div class="move-hitdmg">';for(let e=0;e<t.moves[s].ds.length;e++)r+=t.moves[s].ds[e].d,e+1<t.moves[s].ds.length&&(r+="+");if(r+="</div></div></div></div></div>",r+='<div class="move-extra"><div class="mv-section"><div class="move-special">',t.moves[s].b9&&(r+='<p class="spin">SPIN</p>'),t.moves[s].b8&&(r+='<p class="armor">ARMOR</p>'),t.moves[s].bB&&(r+='<p class="track">TRACK</p>'),r+="</div>",r+='<table class="move-frames"><tr class="move-startf"><td class="mv-id">Start</td><td class="mv-frames">'+t.moves[s].s+"F</td></tr>",t.moves[s].s>0){r+='<tr class="move-startf-seg"><td>'+t.moves[s].s+"F = ";for(var v=1;v<t.moves[s].ss.length;v++)r+=t.moves[s].ss[v].s,v+1<t.moves[s].ss.length&&(r+="+");r+="</td></tr>"}r+='<tr class="move-blockf"><td class="mv-id">Block</td><td class="mv-frames '+(t.moves[s].blk>-1?'blkpositive">+':t.moves[s].blk<-10?'blknegative">':'blkmild">')+t.moves[s].blk+"</td></tr>",r+='<tr class="move-hitf"><td class="mv-id">Hit</td><td class="mv-frames">'+(t.moves[s].adv>0?"+"+t.moves[s].adv:t.moves[s].adv)+"</td></tr></table>",r+="</div>",r+="</div></td>",d3.select(".move-table").append("tr").html(r)}for(var m=1;m<=i;m++){var h=m;d3.select("#dmgmove"+h).on("mouseenter",function(){d3.select("i#"+this.id+" + div.move-hitdmg").style("display","initial")}),d3.select("#dmgmove"+m).on("mouseleave",function(){var e=this.id;setTimeout(function(){d3.select("i#"+e+" + div.move-hitdmg").style("display","none")},3e3)})}document.querySelector("#movelist_tab > table ").firstElementChild.scrollIntoView(!0)})};e.importdata=function(){s(),d3.json("./assets/data/map_hits.json",function(e,s){for(var t in s)c[s[t].i]=s[t].h;d3.json("./assets/data/map_ctrls.json",function(e,s){l=s,d3.json("./assets/data/map_chars.json",function(e,s){for(var t in s)i[s[t].i]={c:s[t].c,n:s[t].n};for(let e=0;e<s.length;e++){var a=s[e].c_index.split(" ");"11"==s[e].i&&(a=s[e].c.split("-")),d3.select(".char-menu > .inner-table > table").append("tr").html('<td class="char-card" id="'+s[e].c.split(" ")[0]+'"><img src="./assets/chars/'+a.join("").toLowerCase()+'_thumbnail.png"><p>'+s[e].c+"</p></td>"),d3.select("#"+s[e].c.split(" ")[0]).on("click",function(){u(s[e].i)})}var o=i[r].c.split(" ");d3.select("#"+o[0]).classed("selected",!0),d3.select("#selected-title").text(i[r].n),u(r)})})})},e.toggleCharMenu=g,e.togglePreferences=function(){m?d3.select("#preferences").style("visibility","hidden"):d3.select("#preferences").style("visibility","visible"),m=!m}}(window);