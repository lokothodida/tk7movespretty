/*!
 * =============================
 * =	Mike Pinto             =
 * =	mspkvp@github.com      =
 * =	Â©2017 tk7movespretty   =
 * ============================= */
!function(t){"use strict";function e(){if(void 0!==Cookies.get("tk7moves")){d3.select("#platf-select > option:nth-child("+(M+1)+")").attr("selected",!1),d3.select("#lang-select > option:nth-child("+(L+1)+")").attr("selected",!1);var t=JSON.parse(Cookies.get("tk7moves"));C=t.selected_char,_=t.lang,L=t.lang_index,x=t.jap,M=t.bl_choice,d3.select("#platf-select > option:nth-child("+(M+1)+")").attr("selected",!0),d3.select("#lang-select > option:nth-child("+(L+1)+")").attr("selected",!0)}else s()}function s(){Cookies.set("tk7moves",JSON.stringify({selected_char:C,lang:_,lang_index:L,jap:x,bl_choice:M}),{expires:30,path:""})}function l(t){return t.toLowerCase()!=t.toUpperCase()}function i(t){d3.select(".move-table").remove(),d3.select(".char-movelist .inner-table").html('<table class="move-table"></table>');var e=w[C].c.split(" ");d3.select("#"+e[0]).classed("selected",!1),e=w[C=t].c.split(" "),d3.select("#"+e[0]).classed("selected",!0),d3.select("#selected-title").text(w[C].n),s(),F&&O()}function a(t){A("./assets/data/movelists/MOVELIST_"+t+".json").then(function(e){i(t),S=e.moves,o(t,S)}).catch(function(t){console.log("Failed to find movelist",t)})}function c(t){let e="",s=t.command[_].split(" ");for(let t=0;t<s.length;t++){let i=s[t];if(/[a-z]/.test(i.toLowerCase()));else for(let t=0;t<i.length;t++){let s="";try{l(y[i.charAt(t)])?s=(y[i.charAt(t)]===y[i.charAt(t)].toLowerCase()||y[i.charAt(t)],y[i.charAt(t)].toLowerCase()):isNaN(y[i.charAt(t)].charAt(0))||(s=y[i.charAt(t)])}catch(t){}e+=s}}return e}function n(){return{moveString:document.querySelector("#move-string-filter").value}}function o(t,e){let s=0;for(let l=0;l<e.length;l++){let i=e[l],a=!i.number>0,c=d3.select(".move-table").append("tr");a?c.html(r(i)):(s++,c.html(d(t,i)))}b(s),document.querySelector("#movelist_tab > table").firstElementChild.scrollIntoView(!0)}function r(t){return'<td class="move-card"><div class="move-info"><div class="move-number">&#9733;</div><div class="move-title"><div class="move-name" style="margin-bottom:5px;">'+t.name[x?0:1]+"</div></div></div></td>"}function d(t,e){let s='<td class="move-card">';return s+=v(t,e),s+=p(e),s+="</td>"}function v(t,e){let s='<div class="move-info">';return s+='<div class="move-number">'+e.number+'</div><div class="move-title"><div class="move-name">'+e.name[x?0:1]+'</div><div class="move-hitamount">'+e.ds.length+(e.ds.length>1?" Hits":" Hit")+"</div></div>",s+=m(e),s+=h(t,e),s+="</div>"}function m(t){let e='<div class="move-string">',s=t.command[_].split(" ");for(let t=0;t<s.length;t++){let i=s[t];if(/[a-z]/.test(i.toLowerCase()))e+='<p class="move-hint">'+i+"</p>";else for(let t=0;t<i.length;t++)try{l(y[i.charAt(t)])?y[i.charAt(t)]===y[i.charAt(t)].toLowerCase()||"N"===y[i.charAt(t)]?e+='<img class="move-arrow" src="./assets/arrow/'+y[i.charAt(t)].toLowerCase()+'.svg">':e+='<img class="move-arrow" src="./assets/arrow/'+y[i.charAt(t)].toLowerCase()+'p.svg">':isNaN(y[i.charAt(t)].charAt(0))?">"===y[i.charAt(t)]?e+='<p class="move-hint" style="color:#37ff05;font-size:20px;"><i class="fa fa-chevron-right" aria-hidden="true"></i></p>':(console.log("1. Not added: "+i.charAt(t)),console.log("2. Not added map: "+y[i.charAt(t)])):e+='<img class="move-button" src="./assets/button/'+E[M]+"/"+y[i.charAt(t)]+'.svg">'}catch(s){"("===i.charAt(t)||i.charAt(t),e+='<p class="move-hint">'+i.charAt(t)+"</p>"}}return e+="</div>"}function h(t,e){let s='<div class="move-hit-dmg"><div class="move-hitlvlstring">';for(let l=0;l<e.at.length;l++){try{s+='<p class="mv-hitlvl hit'+k[e.at[l].l].toLowerCase()+'">'+k[e.at[l].l]+(e.at[l].t>0?" Throw":"")+"</p>"}catch(s){throw console.log(e.at[l].l),console.log(k[e.at[l].l]),console.log("Fighter: "+t),console.log(e.number),s}l+1<e.at.length&&(s+='<i class="fa fa-chevron-right" aria-hidden="true"></i>')}return s+=u(e),s+="</div>",s+=f(e),s+="</div>"}function f(t){let e='<div class="move-dmg"><p class="mv-frames">'+t.d+'</p><p class="mv-id">Damage</p><div class="move-hitdmg-section"><i id="dmgmove'+t.number+'" class="fa fa-plus-square" aria-hidden="true"></i><div class="move-hitdmg">';for(let s=0;s<t.ds.length;s++)e+=t.ds[s].d,s+1<t.ds.length&&(e+="+");return e+="</div></div></div>"}function u(t){let e="";if(t.br.length>0){let s="";switch(t.br[0].b){case 1:s="1";break;case 2:s="2";break;case 3:s="1/2";break;case 4:s="1+2";break;default:s=""}e+='<i class="fa fa-caret-right" aria-hidden="true"></i>',e+='<p class="mv-hitlvl">'+t.br[0].f+"F BREAK "+s+"</p>"}return e}function g(t){let e='<table class="move-frames"><tr class="move-startf"><td class="mv-id">Start</td><td class="mv-frames">'+t.s+"F</td></tr>";if(t.s>0){e+='<tr class="move-startf-seg"><td>'+t.s+"F = ";for(var s=1;s<t.ss.length;s++)e+=t.ss[s].s,s+1<t.ss.length&&(e+="+");e+="</td></tr>"}return e+='<tr class="move-blockf"><td class="mv-id">Block</td><td class="mv-frames '+(t.blk>-1?'blkpositive">+':t.blk<-10?'blknegative">':'blkmild">')+t.blk+"</td></tr>",e+='<tr class="move-hitf"><td class="mv-id">Hit</td><td class="mv-frames">'+(t.adv>0?"+"+t.adv:t.adv)+"</td></tr></table>"}function p(t){let e='<div class="move-extra"><div class="mv-section"><div class="move-special">';return t.b9&&(e+='<p class="spin">SPIN</p>'),t.b8&&(e+='<p class="armor">ARMOR</p>'),t.bB&&(e+='<p class="track">TRACK</p>'),e+="</div>",e+=g(t),e+="</div>",e+="</div>"}function b(t){for(let e=1;e<=t;e++)d3.select("#dmgmove"+e).on("mouseenter",function(){d3.select("i#"+this.id+" + div.move-hitdmg").style("display","initial")}),d3.select("#dmgmove"+e).on("mouseleave",function(){setTimeout(()=>{d3.select("i#"+this.id+" + div.move-hitdmg").style("display","none")},3e3)})}function A(t){return new Promise(function(e,s){d3.json(t,function(t,l){t&&s(t),e(l)})})}var y,w=[],k=[],C="32",S=null,_=1,L=0,x=!1,N=!1,j=!1,F=!1,E=["STEAM","PS4","XBOX"],M=2;String.prototype.hexEncode=function(){var t,e="";for(t=0;t<this.length;t++)e+=("000"+this.charCodeAt(t).toString(16)).slice(-4);return e},String.prototype.hexDecode=function(){var t,e=this.match(/.{1,4}/g)||[],s="";for(t=0;t<e.length;t++)s+=String.fromCharCode(parseInt(e[t],16));return s};var O=function(){F?d3.select("#charmenu").style("display","none"):d3.select("#charmenu").style("display","initial"),F=!F};t.importdata=function(){e(),A("./assets/data/map_hits.json").then(function(t){for(var e in t)k[t[e].i]=t[e].h;return A("./assets/data/map_ctrls.json")}).then(function(t){return y=t,A("./assets/data/map_chars.json")}).then(function(t){for(let e in t)w[t[e].i]={c:t[e].c,n:t[e].n};for(let e=0;e<t.length;e++){let s=t[e].c_index.split(" ");"11"==t[e].i&&(s=t[e].c.split("-")),d3.select(".char-menu > .inner-table > table").append("tr").html('<td class="char-card" id="'+t[e].c.split(" ")[0]+'"><img src="./assets/chars/'+s.join("").toLowerCase()+'_thumbnail.png"><p>'+t[e].c+"</p></td>"),d3.select("#"+t[e].c.split(" ")[0]).on("click",function(){a(t[e].i)})}let e=w[C].c.split(" ");d3.select("#"+e[0]).classed("selected",!0),d3.select("#selected-title").text(w[C].n),a(C)})},t.toggleCharMenu=O,t.togglePreferences=function(){N?d3.select("#preferences").style("visibility","hidden"):d3.select("#preferences").style("visibility","visible"),N=!N},t.toggleFilter=function(){j?d3.select("#filter").style("visibility","hidden"):d3.select("#filter").style("visibility","visible"),j=!j},t.filterMoveList=function(){let t=n(),e=S.filter(function(e){let s=c(e),l=!0;return t.moveString&&(l=l&&s.match(t.moveString)),l});i(C),o(C,e)}}(window);